---
- name: Configure the server and install required software
  hosts: wgvps_servers
  gather_facts: true
  become: true

  tasks:

    - name: Import common role
      ansible.builtin.import_role:
        name: common
      tags: common

    - name: Import dns role
      ansible.builtin.import_role:
        name: dns
      when:
        - wgvps_dns_adblocking or
          dns_encryption
      tags: dns

    - name: Import wireguard role
      ansible.builtin.import_role:
        name: wireguard
      when: wireguard_enabled
      tags: wireguard

    - name: Import searxng role
      ansible.builtin.import_role:
        name: searxng
      when: searxng_enabled
      tags: searxng
