---
# Note: use docker compose, not docker-compose
# apt-cache policy docker-ce
- name: Ensure docker is installed
  ansible.builtin.apt:
    name:
      - docker-ce
      - docker-ce-cli
      - containerd.io
      - docker-compose-plugin
      - "python{{'3' if ansible_python.version.major == 3 else ''}}-docker"
    state: present

# on debian docker is managed by systemd and the following is not strictly necessary:
# sudo systemctl enable docker.service
- name: Ensure docker is enabled and started
  ansible.builtin.systemd:
    service: "{{ item }}"
    state: started
    enabled: true
    masked: false
  with_items:
    - "docker.service"
    - "docker.socket"
  when: not docker_rootless_enabled
